---
const { info } = Astro.props;
const { index, day, band, stage, start, end } = info;
const infoData = JSON.stringify(info);
import S from "./BandInfo.module.css";
---

<article class={S["band-info"]} data-info={infoData}>
  <h2 data-index={index} class={S._band}>{band}</h2>
  <section>
    <p>Tocan en el escenario: <strong>{stage}</strong></p>
  </section>
  <section>
    <p>{start} - {end}</p>
  </section>
  <button
    class={S.likeButton}
    data-index={index}
    data-day={day}
    id={`like-${index}`}
    data-button="like"
  >
    ❤️ Like
  </button>

  <div class="likes-container" data-container={index}></div>
</article>

<!-- <script type="module">
  import { initFireBase, getOnce, updateData } from "/utils/firebase.js";

  const db = initFireBase();
  const currentUser = localStorage.getItem("user");

  if (!currentUser) {
    window.location.href = "/";
  }

  const buttons = document.querySelectorAll('[data-button="like"]');
  if (buttons.length > 0)
    buttons.forEach((button) => {
      debugger;
      if (button)
        button.addEventListener("click", (e) => {
          debugger;
          const btn = e.target.closest(".likeButton");
          if (!btn) return;

          const index = btn.dataset.index;
          const day = btn.dataset.day;
          const path = `data/${day}`;

          const likesContainer = document.querySelector(
            `[data-container="${index}"]`
          );

          getOnce(db, path, async (bandas) => {
            const banda = bandas.find((b) => b.index == index);
            if (!banda) return;

            const likes = new Set([...(banda.likes || []), currentUser]);
            const updatePath = `${path}/${bandas.indexOf(banda)}`;

            await updateData(db, updatePath, { likes: Array.from(likes) });

            // Actualizar UI
            btn.textContent = "✅ Liked";
            btn.disabled = true;

            if (likesContainer) {
              likesContainer.innerHTML = "";
              Array.from(likes).forEach((user) => {
                const img = document.createElement("img");
                img.src = `/fotos/${user}.jpeg`;
                img.alt = user;
                img.title = user;
                img.className = "like-avatar";
                likesContainer.appendChild(img);
              });
            }
          });
        });
    });
</script> -->
